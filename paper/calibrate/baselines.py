import numpy as n
import math
import csv

if __name__ == '__main__':
	prms = {
			'loc': ('-30:43:17.5', '21:25:41.9'), # KAT, SA (GPS)
			'antpos': {
				3: [-1.8703164651063193, -700.38179398735906, -2.486720328795109],
				2: [4.8446646530159176, -700.39598247763035, 9.0712755708770896],
				1: [11.591949094991772, -700.51959903136083, 20.550883906201953],
				0: [18.303883632714129, -700.54155018781171, 32.147239675343215],

				7: [-0.79691390069416523, -299.77026013347034, -1.1324501024272999],
				6: [5.8589125156210056, -299.78452412641195, 10.430549257939724],
				5: [12.570956582720362, -299.96597679156088, 22.013562464192603],
				4: [19.315903718703861, -300.06359266903411, 33.543205414232105],

				11 : [-1.3878432448048694, -500.38082812384613, -1.7545471394250993],
				10 : [5.3138669086039991, -500.49730834340397, 9.946881319840271],
				9: [12.000410085638356, -500.52004427391256, 21.494870295016263],
				8: [18.700416704947475, -500.51760577469884, 32.967807350450215],

				15 : [-0.30041897106453369, -99.592047095062725, -0.4986783217372045],
				14 : [6.4059753694621326, -99.95224098313237, 10.967587452252552],
				13 : [13.103671269187693, -100.16568752920908, 22.495562579989407],
				12 : [19.71347252253916, -100.15113820962031, 33.991849122807949],

				19 : [-1.4502397412457093, -600.18812435901839, -1.9179935464574072],
				18 : [5.1717744224385322, -600.38441009883991, 9.5482722259790709],
				17 : [11.92743084773735, -600.50952069915058, 21.087922100514781],
				16 : [18.660932830697366, -600.37151947354073, 32.734312482817408],

				23 : [-0.65004684427314674, -199.90294892149257, -0.70882370043213849],
				22 : [6.085058720866952, -199.91607722453426, 10.832493993299661],
				21 : [12.764558079120691, -200.09371555153467, 22.343790916649397],
				20 : [19.490548357060103, -200.03876633995446, 33.933475405899749],

				27 : [-1.1241140538220571, -400.00575563876032, -1.5594121443679183],
				26 : [5.627745048786398, -400.21358435343956, 10.011926318192666],
				25 : [12.334663628936832, -400.32135868916214, 21.53990144903608],
				24 : [19.066037795876635, -400.28464748951757, 33.111239910043388],

				31 : [0.0, 0.0, 0.0],
				30 : [6.6895727415641932, 0.035200138018290757, 11.576341924808688],
				29 : [13.380230127377081, 0.14164134349682395, 23.136005645230252],
				28 : [20.113783156528598, 0.12912235844973025, 34.702340643989459],
			},
			'ant_layout': n.array(
				[[0, 16, 8, 24, 4, 20, 12, 28],
				 [1, 17, 9, 25, 5, 21, 13, 29],
				 [2, 18, 10, 26, 6, 22, 14, 30],
				 [3, 19, 11, 27, 7, 23, 15, 31]]),
	}
	lat = 30.72152778
	antmeters = prms['antpos']
	#print antmeters
	antproj = antmeters
	writefile = '/data4/paper/mmodes/PSA-64/antennapos.dat'

	with open(writefile, 'w') as f:
		for i, ant in enumerate(prms['antpos']):
			for coor in prms['antpos'][ant]:
				antmeters[ant][i] = coor * 3/10
			if i == 0:
				antproj[ant][i] = antmeters[ant][i] / math.sin(n.radians(lat))
			#if i == 2:
			#	antproj[ant][i] = antmeters[ant][i] / math.sin(n.radians(lat))
			line = ' '.join((str(ant), str(antmeters[ant][0]), str(antmeters[ant][1])))
			print line
			f.write(line + '\n')
	'''
	comp = antproj
	for ant in antproj:
		#if ant != 31:
		#continue
		for antc in comp:
		(x, y, z) = antproj[ant]
		(xc, yc, zc) = comp[antc]
		distance = math.sqrt((x-xc)**2 + (y-yc)**2)
		if y > yc and distance != 0:
			phi = math.degrees(math.acos((yc - y)/distance))
		elif y < yc and distance != 0: 
			phi = math.degrees(math.asin((xc - x)/distance))
		else:
			phi = 0
		with open('paperbaselines.csv', 'a') as csvfile:
			basewriter = csv.writer(csvfile, delimiter=' ')
			b_b = str(ant) + '_' + str(antc)
			basewriter.writerow([b_b, distance, phi])
	'''
